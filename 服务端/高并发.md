### 前置知识
- `QPS`：每秒钟请求或者查询的数量，在互联网领域是每秒响应请求数(HTTP请求)
  - 不等于并发连接数
- 吞吐量：单位时间内处理的请求数量（通常由QPS与并发数决定）
- 响应时间：请求发出到收到响应的时间
- `PV`：综合浏览量，指页面浏览量或者点击量。同一个人浏览某个网站一个页面，只记做一个PV
- `UV`：独立访客，一段时间内同一个访客访问多次访问记作一次
- 日网站带宽：PV/统计时间（换算到秒）*平均页面大小（单位KB）*8

### 压力测试
- 可以测试能承受的最大并发数
- 测试最大承受的QPS值
- 常用测试工具
  - `ab`：全称`Apache Benchmark`,Apache官方出品工具
    - 原理
      - 创建多个并发访问线程模拟多个访问者同时推某URL进行访问
      - 测试目标基于URL，可以测试Apache、Nginx等wWeb服务器压力
        ```shell
            # 并发请求100 一共请求5000
            ab -c 100 -n 5000 测试网址 
        ```
      - 测试机器和被测试机器分开
      - 不要对线上服务压测
      - 观察测试工具ab所在机器，以及被测试的前端机的CPU，内存，网诺都不得超过最高限度75%
    - 安装
      - `yum install http-tools`
  - `wrk`
  - `http_load`
  - `Web Bench`
  - `Siege`
  - `Apache JMeter`
  
### 高并发解决方案案例
- 流量优化
  - 防盗链处理
- 前端优化
  - 减少HTTP请求
  - 添加异步请求
  - 启用浏览器缓存和文件压缩
  - CDN加速
  - 建立独立的图片服务器
- 服务端优化
  - 页面静态化
  - 并发处理：队列，多线程等等
- 数据库优化
  - 数据库缓存
  - 分库分表，分区操作
  - 读写分离
  - 负载均衡
- web服务器优化
  - 负载均衡：nginx，LVS等

- CDN加速
  - 内容分发网络（content delivery network）
  - 尽可能避免互联网上影响数据传输速度和稳定性的瓶颈和环节，使内容传输更快更稳定
  - 在网络各处防止节点服务器所构成的现有的互联网基础之上的一层智能虚拟网络
  - CDN可以实时的根据网络流量和各个节点连接，负载情况以及用户距离和响应时间等综合信息将用户请求导向更合适的服务节点
  - 优势
    - 本地cache加速，提高企业站点访问（尤其是大量图片和静态网页站点）
    - 跨运营商网络加速，保证不同网络用户都能得到良好的访问质量
    - 远程用户根据DNS负载均衡技术智能自动选择cache服务器
    - 自动生成远程镜像cache服务器，远程用户访问从cache服务器上读取数据，减少远程访问的带宽，分担网络流量。减轻原站点web服务器负载等
    - 广泛分布的CDN节点加上节点之间的智能冗余机制，有效预防黑客入侵
  - 工作原理
    - 传统：用户输入域名发起请求-》解析域名获取服务器ip地址-》根据ip地址找到对应服务器-》服务器响应并返回数据
    - CDN：用户发起请求-》智能DNS解析（根据ip判断地理位置、接入网类型、选择路由最短负载最轻的服务器）-》取得缓存服务器ip-》返回内容给他用户（如果缓存有返回没有则继续）-》向源站发起请求-》将结果返回给用户-》将结果存入缓存服务器
  - 适用场景
    - 站点或应用中大量静态资源加速分发（比如css、js。html、图片）
    - 大文件下载
    - 直播网站
  - 实现
    - 可以使用现有的商业的CDN服务
    - LVS做四层负载均衡
    - Nginx等做7层负载均衡和cache
    - 使用Nginx等做反向代理